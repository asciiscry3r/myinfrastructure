---

- name: Get system upgrades | Arch
  pacman:
    upgrade: yes
    update_cache: yes
  register: server_system_upgrades
  tags:
    - update_server
    - reboot_machine

- name: Install apparmor profiles and system utils | Arch
  pacman:
    pkg: '{{ item }}'
    update_cache: yes
    state: latest
  with_items:
    - logrotate
    - apparmor
  tags:
    - update_server

- name: Install user defined packages | Arch
  pacman:
    pkg: '{{ item.name }}'
    update_cache: yes
    state: '{{ item.state }}'
  with_items:
    - "{{ server_apps }}"
  tags:
    - manage_packages

- name: Added umask to bash | Arch
  lineinfile:
    path: .bashrc
    state: present
    line: 'umask 027'
  tags:
    - update_server
 
- name: Added candys to bash | Arch
  lineinfile:
    path: .bashrc
    state: present
    line: 'fortune | cowsay -f tux | lolcat'
  tags:
    - update_server

- name: Check if machine required reboot | Arch
  stat:
    dest: /var/run/reboot-required
  register: machine_reboot_required
  tags:
    - reboot_machine
