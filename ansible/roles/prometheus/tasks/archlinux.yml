---

- name: Update pacman keyring | Arch
  shell: |
    pacman-key --init &&
    pacman-key --populate
  become: true
  become_user: root
  tags:
    - update_server
    - reboot_machine  

- name: Update pacman database | Arch
  shell: sudo pacman -Sy
  tags:
    - update_server
    - reboot_machine  

- name: Install apparmor profiles and system utils | Arch
  pacman:
    pkg: '{{ item }}'
    update_cache: yes
    state: latest
  with_items:
    - prometheus
    - alertmanager
  tags:
    - update_server

#
# wireguard_exporter ALL=(root) NOPASSWD: /usr/bin/wg
#
- name: Install apparmor profiles and system utils | Arch
  pacman:
    pkg: '{{ item }}'
    update_cache: yes
    state: latest
  with_items:
    - prometheus-node-exporter
    - prometheus-process-exporter-bin
    - prometheus-systemd-exporter
    - prometheus-wireguard-exporter
    - prometheus-nginxlog-exporter-bin
    - nginx-prometheus-exporter
  tags:
    - update_server
